function isHooked(e,r){return"symbol"!=typeof r&&(!r.startsWith("$$")&&(!(r in e.__proto__)&&(!Array.isArray(e)||!isNaN(r))))}function inPrototype(e){return e in ChomRef.prototype&&"function"==typeof ChomRef.prototype[e]}function wrapToArray(e){return e.$$chomRef?[e]:Array.isArray(e)?e:[e]}class ChomRefHandler{constructor(e){this.hookerReceiver=e,this.dep=[]}beforeGet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){}afterGet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){}beforeSet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o,value:i}){}afterSet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o,value:i}){}beforeDelete({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){}afterDelete({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){}addDep(e,r){this.dep.push(e),e.$$hook(r,this)}refreshHookerReceiver(){this.hookerReceiver=this.hookerReceiver.$$}}class ChomRefCustomHandler extends ChomRefHandler{constructor(e,{beforeGet:r,afterGet:t,beforeSet:o,afterSet:i,beforeDelete:h,afterDelete:a}){super(e),this._beforeGet=r,this._afterGet=t,this._beforeSet=o,this._afterSet=i,this._beforeDelete=h,this._afterDelete=a}beforeGet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){"function"==typeof this._beforeGet&&this._beforeGet({hooker:e,target:r,hookerReceiver:t,targetReceiver:o})}afterGet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){"function"==typeof this._afterGet&&this._afterGet({hooker:e,target:r,hookerReceiver:t,targetReceiver:o})}beforeSet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o,value:i}){"function"==typeof this._beforeSet&&this._beforeSet({hooker:e,target:r,hookerReceiver:t,targetReceiver:o,value:i})}afterSet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o,value:i}){"function"==typeof this._afterSet&&this._afterSet({hooker:e,target:r,hookerReceiver:t,targetReceiver:o,value:i})}beforeDelete({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){"function"==typeof this._beforeDelete&&this._beforeDelete({hooker:e,target:r,hookerReceiver:t,targetReceiver:o})}afterDelete({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){"function"==typeof this._afterDelete&&this._afterDelete({hooker:e,target:r,hookerReceiver:t,targetReceiver:o})}}class ChomRefElement extends ChomRefHandler{constructor(e,r,t=(()=>{})){super(e),t.call(this),this.pureid=Math.floor(1e8*Math.random()),this.parent=wrapToArray(r),this.performBuild(),this.performUpdate()}build(e=this.hookerReceiver){return!1}performBuildSingle(e,r=this.hookerReceiver,t=!0){if(e instanceof HTMLElement){if(e.querySelector(":scope > .chomref-ele-pureid-"+this.pureid))return;if((f=this.build(r))&&f.ele){for(var o of(f.ele=wrapToArray(f.ele),f.ele))o.classList.add("chomref-ele-pureid-"+this.pureid),t&&e.appendChild(o);this.ele||(this.ele=[]),this.ele=[...this.ele,...f.ele],f.childContainer&&(f.childContainer=wrapToArray(f.childContainer),this.childContainer||(this.childContainer=[]),this.childContainer=[...this.childContainer,...f.childContainer])}return f}if(!e.$$chomRef)throw new Error("Parent must be HTMLElement or ChomRef but got: "+e);var i=e.$$ele;for(var h in i){var a=i[h],c=a.childContainer;if(c)for(var l of c){var f;if((f=this.performBuildSingle(l,r,!1))&&f.ele)for(var o of f.ele)a.performAddChild(r,o,l)}}}performBuild(e=this.hookerReceiver){for(var r of this.parent)this.performBuildSingle(r,e)}afterAttached(e=this.hookerReceiver){}update(e,r=this.hookerReceiver){}performUpdate(e=this.ele,r=this.hookerReceiver){if(e)for(var t of e)this.update(t,r)}addChild(e,r,t){return t.appendChild(r),r}performAddChild(e,r,t){var o=[];if(t){var i=t.querySelectorAll(":scope > .chref-ele-key-"+e.$$key);0==i.length&&(i=this.addChild(e,r,t),Array.isArray(i)||(i=[i])),o=[...o,...i]}for(var h of o)h.classList.add("chref-ele-order-"+e.$$key),h.classList.add("chref-ele-key-"+e.$$key),h.style.order=parseInt(e.$$key)}beforeGet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){}afterGet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){}beforeSet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o,value:i}){}afterSet({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o,value:i}){this.performBuild(this.parentEle),this.performUpdate()}beforeDelete({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){}afterDelete({hooker:e=this.hookerReceiver.$$,target:r,hookerReceiver:t=this.hookerReceiver,targetReceiver:o}){for(var i of this.ele)i.parentNode&&i.parentNode.removeChild(i);this.ele=void 0,this.childContainer=void 0}}class ChomRefTemplate{$$get(){return this.$$parent[this.$$parentKey]}$$set(e){return this.$$parent[this.$$parentKey]=e,this.$$get()}$$performHookSingle(e,r={}){var t=this.$$hookFunc;for(var o in t)t[o][e].locked||(t[o][e].locked=!0,"afterSet"===e&&t[o].refreshHookerReceiver(),r.target=r.targetReceiver.$$,t[o][e](r),t[o][e].locked=!1)}$$performHookBP(e,r={}){this.$$performHookSingle(e,r),this.$$parent&&this.$$parent.$$performHookBP(e,r)}$$performHook(e,r={}){r={targetReceiver:this,...r},"afterSet"===e||"beforeSet"===e?this.$$performHookBP(e,r):this.$$performHookSingle(e,r)}$$hook(e,r,t){var o=this.$$hookFunc;o[e]=void 0===t?r instanceof ChomRefHandler?r:new r(this):new ChomRefCustomHandler(this,{[r]:t})}$$childPerform(e,r){for(var t in this.$$childPerformFunc[e]=r,this)r(this[t])}$$doChildPerform(e){for(var r in this.$$childPerformFunc)this.$$childPerformFunc[r](e)}$$attachEle(e,r,t){if(!this.$$ele[e]){var o=new r(this,t);this.$$hook(e,o),this.$$ele[e]=o,o.afterAttached(this)}}$$construct(){}}var proxyHandler={get(e,r,t){if("$$raw"===r)return e;if("$$chomRef"===r)return!0;if("valueOf"===r)return Reflect.get(e,Symbol.toPrimitive);if("$$key"===r)return Reflect.get(e,"$$parentKey");if("symbol"==typeof r)return Reflect.get(...arguments);if(r in e.__proto__)return Reflect.get(e,r);var o=Reflect.get(e,"$$class");if(r in o.prototype&&"function"==typeof o.prototype[r])return o.prototype[r].bind(t);var i=Reflect.get(...arguments);isHooked(e,r)&&void 0===i&&(Reflect.set(e,r,ChomRef(void 0,{parent:t,parentKey:r,root:Reflect.get(e,"$$root")})),i=Reflect.get(...arguments));var h=Reflect.get(e,"$$parent"),a=Reflect.get(e,"$$parentKey");if(r.startsWith("$$getRaw$")){r=r.substr(9);var c=Reflect.get(e,r);if(c&&c.$$chomRef)return c;var l=ChomRef(c,{parent:t,parentKey:r,root:Reflect.get(e,"$$root"),classTemplate:Reflect.get(e,"$$childClassTemplate")});return Reflect.set(e,r,l),l}if("$$"===r)return o.prototype.$$get.call(t);if(r.startsWith("$$")&&"$$mark"!==r)return Reflect.get(...arguments);if(void 0===h)l=Reflect.get(e,r);else l=h["$$getRaw$"+a]["$$getRaw$"+r];isHooked(e,r)&&(0,l.$$performHook)("afterGet");return l},set(e,r,t,o){if(!isHooked(e,r))return Reflect.set(...arguments);var i=o[r];isHooked(e,r)&&(0,i.$$performHook)("beforeSet",{value:t});var h={},a={},c={};i&&i.$$chomRef&&(h=i.$$hookFunc,a=i.$$childPerformFunc,c=i.$$ele);var l=Reflect.set(e,r,ChomRef(t,{parent:o,parentKey:r,root:Reflect.get(e,"$$root"),classTemplate:Reflect.get(e,"$$childClassTemplate"),$$hookFunc:h,$$childPerformFunc:a,$$ele:c}));(i=Reflect.get(e,r),o.$$doChildPerform(i),isHooked(e,r))&&(0,i.$$performHook)("afterSet",{value:t});return l},deleteProperty(e,r){var t=Reflect.get(e,r).$$performHook;isHooked(e,r)&&t("beforeDelete");var o=Reflect.deleteProperty(...arguments);return isHooked(e,r)&&t("afterDelete"),o}};function ChomRef(e,r){var t;if("object"!=typeof e){var o=e;e={value:e,[Symbol.toPrimitive]:e=>o}}else if(Array.isArray(e))e=[...e];else{var i=e.__proto__;e=Object.assign(Object.create(i),e)}t=new Proxy(e,proxyHandler),r||(r={}),r.root||r.allowRoot||(r.root=ChomRef({value:t},{allowRoot:!0}),r.parent=r.root,r.parentKey="value",r.newRoot=!0);var h=r.classTemplate||ChomRefTemplate,a=r.childClassTemplate||ChomRefTemplate;return Object.defineProperty(e,"$$parent",{value:r.parent,enumerable:!1,writable:!0}),Object.defineProperty(e,"$$parentKey",{value:r.parentKey,enumerable:!1,writable:!0}),Object.defineProperty(e,"$$root",{value:r.root||t,enumerable:!1,writable:!0}),Object.defineProperty(e,"$$class",{value:h,enumerable:!1,writable:!0}),Object.defineProperty(e,"$$childClass",{value:a,enumerable:!1,writable:!0}),Object.defineProperty(e,"$$hookFunc",{value:r.$$hookFunc||{},enumerable:!1,writable:!0}),Object.defineProperty(e,"$$ele",{value:r.$$ele||{},enumerable:!1,writable:!0}),Object.defineProperty(e,"$$mark",{value:{},enumerable:!1,writable:!0}),Object.defineProperty(e,"$$childPerformFunc",{value:r.$$childPerformFunc||{},enumerable:!1,writable:!0}),t.$$construct(),r.newRoot&&t.$$get(),t}